[config]
default_to_workspace = false

[tasks.default]
alias = "help"

[tasks.help]
description = "利用可能なコマンドを表示"
script = '''
echo "利用可能なコマンド:"
echo "  makers sync           - uvを使って依存関係をインストール"
echo ""
echo "dbtコマンド:"
echo "  makers dbt deps       - dbtパッケージをインストール"
echo "  makers dbt seed       - シードデータをロード"
echo "  makers dbt run        - dbtモデルを実行"
echo "  makers dbt test       - dbtテストを実行"
echo "  makers dbt docs generate - dbtドキュメントを生成"
echo "  makers dbt docs serve    - dbtドキュメントを配信"
echo ""
echo "その他のコマンド:"
echo "  makers build          - deps + seed + run + test を一括実行"
echo "  makers streamlit      - Streamlitアプリを起動"
echo "  makers duckdb         - DuckDB CLIを起動"
echo "  makers clean          - 生成ファイルをクリーンアップ"
'''

[tasks.sync]
description = "uvを使って依存関係をインストール"
command = "uv"
args = ["sync"]

# dbtコマンドのラッパー
[tasks.dbt]
description = "dbtコマンドを実行 (例: makers dbt run)"
script_runner = "@shell"
script = '''
if [ -z "${1}" ]; then
  echo "使い方: makers dbt <コマンド>"
  echo "例: makers dbt run, makers dbt seed, makers dbt test"
  exit 1
fi
uv run dbt "$@"
'''

[tasks.build]
description = "deps + seed + run + test を一括実行"
dependencies = ["sync"]
clear = true
script = '''
uv run dbt deps
uv run dbt seed
uv run dbt run
uv run dbt test
'''

[tasks.streamlit]
description = "Streamlitアプリを起動"
command = "uv"
args = ["run", "streamlit", "run", "app.py"]

[tasks.duckdb]
description = "DuckDB CLIを起動"
command = "uv"
args = ["run", "duckdb", "dbt_core_demo_cafe.duckdb"]

[tasks.clean]
description = "生成ファイルをクリーンアップ"
script = '''
rm -rf .venv dbt_packages logs target
'''
